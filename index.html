<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心灵休憩空间</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f8f9fa;
            color: #4a5568;
            line-height: 1.8;
        }
        
        .bg-gradient {
            background: linear-gradient(135deg, #e6f7ff 0%, #f0fff4 50%, #faf5ff 100%);
        }
        
        .card {
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        .nature-img {
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .nature-img:hover {
            transform: scale(1.02);
        }
        
        .btn-primary {
            background-color: #90cdf4;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: #63b3ed;
        }
        
        .mood-tracker {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
        }
        
        .mood-btn {
            transition: all 0.2s ease;
        }
        
        .mood-btn:hover {
            transform: scale(1.1);
        }
        
        .quote {
            font-style: italic;
            color: #718096;
            border-left: 4px solid #90cdf4;
        }
        
        .visual-effect-container {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        
        .effect-btn {
            transition: all 0.2s ease;
        }
        
        .effect-btn:hover {
            transform: scale(1.05);
        }
        
        .active-effect {
            background-color: #ebf8ff;
            border-color: #63b3ed;
        }
        
        .canvas-container {
            position: relative;
            width: 100%;
            height: 300px;
            overflow: hidden;
            border-radius: 12px;
            background-color: #f0f7ff;
            cursor: pointer;
        }
        
        #visualCanvas {
            width: 100%;
            height: 100%;
        }
        
        .breathing-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: radial-gradient(circle, #63b3ed 0%, #ebf8ff 70%);
            opacity: 0.8;
            animation: breathing 5s infinite ease-in-out;
        }
        
        @keyframes breathing {
            0%, 100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0.8;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
        }

        .mood-history-card {
            transition: all 0.3s ease;
            margin-right: 15px;
            flex: 0 0 280px;
        }
        
        .mood-history-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
        }
        
        .mood-cards-container {
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 15px 5px;
            -webkit-overflow-scrolling: touch;
        }
        
        .mood-cards-container::-webkit-scrollbar {
            height: 8px;
        }
        
        .mood-cards-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .mood-cards-container::-webkit-scrollbar-thumb {
            background: #b6e0fe;
            border-radius: 10px;
        }
        
        .mood-cards-container::-webkit-scrollbar-thumb:hover {
            background: #90cdf4;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .card-animation {
            animation: fadeIn 0.5s ease-out;
        }
        
        .delete-btn {
            transition: all 0.2s ease;
        }
        
        .delete-btn:hover {
            color: #f56565;
        }

        /* 泡泡动画样式 */
        .bubble {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.1));
            box-shadow: 0 0 8px rgba(120, 180, 255, 0.3);
            animation: float 8s ease-in-out infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(100%) scale(0.8);
                opacity: 0;
            }
            5% {
                opacity: 1;
            }
            95% {
                opacity: 1;
            }
            100% {
                transform: translateY(-20%) scale(1);
                opacity: 0;
            }
        }

        /* 波浪动画样式 */
        .wave {
            position: absolute;
            width: 100%;
            height: 20px;
            background: linear-gradient(to right, #63b3ed, #90cdf4, #63b3ed);
            opacity: 0.3;
            border-radius: 50%;
            transform-origin: 50% 50%;
            animation: wave 8s linear infinite;
        }

        @keyframes wave {
            0% {
                transform: scale(0.1, 0.1);
                opacity: 0;
            }
            20% {
                opacity: 0.5;
            }
            80% {
                opacity: 0.5;
            }
            100% {
                transform: scale(3, 0.1);
                opacity: 0;
            }
        }

        /* 飘落树叶样式 */
        .leaf {
            position: absolute;
            width: 20px;
            height: 20px;
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.8;
            animation: falling 10s ease-in-out infinite;
        }

        @keyframes falling {
            0% {
                transform: translateY(-5%) translateX(10%) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(105%) translateX(-10%) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* 波纹动画效果 */
        .ripple {
            position: absolute;
            border-radius: 50%;
            transform: scale(0);
            animation: ripple-effect 1s linear;
            background-color: rgba(255, 255, 255, 0.4);
        }
        
        @keyframes ripple-effect {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        /* 头像选择样式 */
        .avatar-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .avatar-option {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #f0f7ff;
            font-size: 24px;
            border: 2px solid transparent;
        }
        
        .avatar-option:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .avatar-selected {
            border-color: #4299e1;
            box-shadow: 0 0 8px rgba(66, 153, 225, 0.6);
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-gradient min-h-screen">
    <div class="container mx-auto px-4 py-12">
        <!-- 欢迎标题 -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-light text-indigo-800 mb-4">心灵休憩空间</h1>
            <p class="text-xl text-blue-600 font-light">在繁忙中找寻片刻宁静，让心灵得到舒展</p>
        </header>

        <!-- 主要内容 -->
        <main>
            <!-- 动态放松视觉效果区域 -->
            <section class="mb-16">
                <div class="visual-effect-container p-6">
                    <h2 class="text-2xl text-teal-700 mb-4 text-center">视觉放松空间</h2>
                    <p class="text-center mb-6">选择一种视觉效果，让眼睛和心灵一同放松</p>
                    
                    <div class="canvas-container mb-6" id="visualContainer">
                        <canvas id="visualCanvas"></canvas>
                        <div id="breathingCircle" class="breathing-circle" style="display: none;"></div>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 mb-2">
                        <button class="effect-btn p-3 border rounded-lg text-left text-gray-700 hover:bg-blue-50 focus:outline-none" data-effect="bubbles">
                            <i class="fas fa-circle text-blue-500 mr-2"></i> 彩色泡泡
                        </button>
                        
                        <button class="effect-btn p-3 border rounded-lg text-left text-gray-700 hover:bg-blue-50 focus:outline-none" data-effect="waves">
                            <i class="fas fa-water text-blue-600 mr-2"></i> 波浪流动
                        </button>
                        
                        <button class="effect-btn p-3 border rounded-lg text-left text-gray-700 hover:bg-blue-50 focus:outline-none" data-effect="breathing">
                            <i class="fas fa-lungs text-purple-600 mr-2"></i> 呼吸引导
                        </button>
                        
                        <button class="effect-btn p-3 border rounded-lg text-left text-gray-700 hover:bg-blue-50 focus:outline-none" data-effect="leaves">
                            <i class="fas fa-leaf text-green-600 mr-2"></i> 飘落的花瓣
                        </button>
                    </div>
                    
                    <p class="text-center text-sm text-gray-500 mt-3">
                        提示：点击任意效果按钮开始或切换动画，点击画面与动画互动
                    </p>
                </div>
            </section>

            <!-- 关于放松心情的内容 -->
            <section class="mb-16">
                <div class="card p-8 mb-12">
                    <h2 class="text-2xl text-teal-700 mb-6">寻找内心的平静</h2>
                    <p class="mb-4">在现代快节奏的生活中，我们的心灵常常被各种压力和焦虑所困扰。然而，真正的宁静并不需要远离尘嚣，它就藏在我们的内心深处，等待被唤醒。</p>
                    <p class="mb-4">放松不仅仅是身体的休息，更是心灵的归位。当我们学会放慢脚步，感受呼吸，观察周围的美好，我们就能逐渐找回内心的平静。</p>
                    
                    <div class="quote pl-4 py-3 mt-6">
                        "平静的心灵能看到最美的风景，安宁的灵魂能听到最动人的声音。"
                    </div>
                </div>

                <!-- 自然风景图片 -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-16">
                    <div>
                        <img src="https://images.unsplash.com/photo-1447752875215-b2761acb3c5d?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="宁静森林" class="nature-img w-full h-64 object-cover">
                        <p class="text-center mt-2 text-gray-600">宁静的森林小路</p>
                    </div>
                    <div>
                        <img src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="平静湖泊" class="nature-img w-full h-64 object-cover">
                        <p class="text-center mt-2 text-gray-600">平静如镜的湖面</p>
                    </div>
                    <div>
                        <img src="https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="壮丽山脉" class="nature-img w-full h-64 object-cover">
                        <p class="text-center mt-2 text-gray-600">壮丽而宁静的山脉</p>
                    </div>
                </div>
            </section>

            <!-- 舒缓心灵的小贴士 -->
            <section class="mb-16">
                <h2 class="text-2xl text-teal-700 mb-8 text-center">舒缓心灵的小贴士</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card p-6">
                        <div class="text-blue-500 text-3xl mb-4 text-center">
                            <i class="fas fa-lungs"></i>
                        </div>
                        <h3 class="text-xl text-indigo-700 mb-3">正念呼吸</h3>
                        <p>找一个安静的地方坐下，闭上眼睛，专注于呼吸。感受空气进入鼻腔，充满肺部，再缓缓呼出。当杂念出现时，不要自责，只需将注意力重新拉回呼吸上。每天坚持5-10分钟，便能感受内心的平静。</p>
                    </div>
                    
                    <div class="card p-6">
                        <div class="text-green-500 text-3xl mb-4 text-center">
                            <i class="fas fa-tree"></i>
                        </div>
                        <h3 class="text-xl text-indigo-700 mb-3">亲近自然</h3>
                        <p>自然是最好的心灵疗愈师。安排时间去公园散步，或是远足山林。聆听鸟鸣，感受微风，观察植物的生长。大自然的节奏能帮助我们找回生命的本真，缓解内心的焦虑。</p>
                    </div>
                    
                    <div class="card p-6">
                        <div class="text-purple-500 text-3xl mb-4 text-center">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <h3 class="text-xl text-indigo-700 mb-3">阅读疗愈</h3>
                        <p>选择一本喜爱的书籍，找一个舒适的角落，沉浸在文字的世界中。阅读能让我们暂时远离现实的压力，进入另一个时空，获得心灵的宁静与滋养。</p>
                    </div>
                    
                    <div class="card p-6">
                        <div class="text-yellow-500 text-3xl mb-4 text-center">
                            <i class="fas fa-walking"></i>
                        </div>
                        <h3 class="text-xl text-indigo-700 mb-3">动态冥想</h3>
                        <p>在日常活动中保持专注，如走路时关注脚步与地面的接触，吃饭时专注食物的味道与口感。这种"活在当下"的状态能让心灵摆脱过去的遗憾与未来的担忧，获得真正的平静。</p>
                    </div>
                    
                    <div class="card p-6">
                        <div class="text-red-400 text-3xl mb-4 text-center">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h3 class="text-xl text-indigo-700 mb-3">培养感恩</h3>
                        <p>每天记录三件感恩的事，无论大小。感恩能够改变我们看待生活的视角，使我们更容易发现生活中的美好，从而增加幸福感，减轻焦虑与压力。</p>
                    </div>
                    
                    <div class="card p-6">
                        <div class="text-blue-400 text-3xl mb-4 text-center">
                            <i class="fas fa-moon"></i>
                        </div>
                        <h3 class="text-xl text-indigo-700 mb-3">优质睡眠</h3>
                        <p>保证充足的睡眠是缓解压力的基础。建立规律的作息时间，睡前一小时避免使用电子设备，创造舒适的睡眠环境。良好的睡眠能让身心得到真正的休息与恢复。</p>
                    </div>
                </div>
            </section>

            <!-- 互动区域：心情记录 -->
            <section class="mb-16">
                <div class="mood-tracker p-8">
                    <h2 class="text-2xl text-teal-700 mb-6 text-center">分享您的心情</h2>
                    <p class="text-center mb-6">记录当下的心情，分享您的感受</p>
                    
                    <!-- 头像选择器 -->
                    <div class="mb-6">
                        <p class="text-center mb-3 text-gray-700">选择一个头像 (可选)</p>
                        <div class="avatar-selector">
                            <div class="avatar-option" data-avatar="anonymous">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="avatar-option" data-avatar="male1">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="avatar-option" data-avatar="female1">
                                <i class="fas fa-female"></i>
                            </div>
                            <div class="avatar-option" data-avatar="neutral1">
                                <i class="fas fa-user-astronaut"></i>
                            </div>
                            <div class="avatar-option" data-avatar="male2">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="avatar-option" data-avatar="female2">
                                <i class="fas fa-user-nurse"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mood-selector flex flex-wrap justify-center gap-4 mb-8">
                        <button class="mood-btn p-4 rounded-full bg-red-100 hover:bg-red-200 focus:outline-none" onclick="selectMood('joyful')">
                            <span class="text-2xl">😊</span>
                            <span class="block mt-1">愉悦</span>
                        </button>
                        <button class="mood-btn p-4 rounded-full bg-orange-100 hover:bg-orange-200 focus:outline-none" onclick="selectMood('calm')">
                            <span class="text-2xl">😌</span>
                            <span class="block mt-1">平静</span>
                        </button>
                        <button class="mood-btn p-4 rounded-full bg-yellow-100 hover:bg-yellow-200 focus:outline-none" onclick="selectMood('excited')">
                            <span class="text-2xl">😃</span>
                            <span class="block mt-1">兴奋</span>
                        </button>
                        <button class="mood-btn p-4 rounded-full bg-blue-100 hover:bg-blue-200 focus:outline-none" onclick="selectMood('tired')">
                            <span class="text-2xl">😔</span>
                            <span class="block mt-1">疲惫</span>
                        </button>
                        <button class="mood-btn p-4 rounded-full bg-purple-100 hover:bg-purple-200 focus:outline-none" onclick="selectMood('anxious')">
                            <span class="text-2xl">😟</span>
                            <span class="block mt-1">焦虑</span>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <label for="moodNote" class="block mb-2 text-gray-700">记录一下您的感受:</label>
                        <textarea id="moodNote" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" placeholder="写下您的感受..."></textarea>
                    </div>
                    
                    <div class="flex justify-center space-x-4">
                        <button id="saveMoodBtn" class="btn-primary px-6 py-2 rounded-lg text-white focus:outline-none">
                            记录心情
                        </button>
                        <button id="clearPersonalBtn" class="px-6 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 focus:outline-none">
                            清除我的记录
                        </button>
                    </div>
                    
                    <div id="moodMessage" class="mt-4 text-center hidden"></div>
                </div>
            </section>

            <!-- 共享历史记录区域 - 滚轮式显示 -->
            <section class="mb-20">
                <div class="card p-8">
                    <h2 class="text-2xl text-teal-700 mb-6 text-center">心情共享墙</h2>
                    <p class="text-center mb-6">在这里，我们互相分享心情，给予温暖与理解</p>
                    
                    <div class="mood-cards-container" id="moodCardsContainer">
                        <!-- 历史记录将在这里动态加载为横向滚动卡片 -->
                    </div>
                    
                    <div class="text-center text-gray-500 py-8 hidden" id="noRecordsMessage">
                        暂无记录，成为第一个分享心情的人吧！
                    </div>
                    
                    <div class="flex justify-center mt-4">
                        <button id="scrollLeftBtn" class="p-2 bg-blue-100 text-blue-700 rounded-full mr-4 focus:outline-none">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button id="scrollRightBtn" class="p-2 bg-blue-100 text-blue-700 rounded-full focus:outline-none">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- 放松指南 -->
            <section class="mb-20">
                <div class="card p-8">
                    <h2 class="text-2xl text-teal-700 mb-6">一分钟放松指南</h2>
                    <p class="mb-4">当压力来袭时，这个简单的放松练习可以帮助你快速平静下来：</p>
                    
                    <ol class="list-decimal pl-6 space-y-3">
                        <li>找一个舒适的姿势坐下，双脚平放在地上</li>
                        <li>闭上眼睛，深吸一口气，数到4</li>
                        <li>屏住呼吸，数到2</li>
                        <li>缓缓呼气，数到6</li>
                        <li>重复这个过程5次</li>
                        <li>感受身体的放松，注意力放在当下</li>
                    </ol>
                    
                    <p class="mt-4">这个简单的练习可以在任何地方进行，帮助你在忙碌的一天中找到片刻的平静。</p>
                </div>
            </section>
        </main>

        <!-- 页脚 -->
        <footer class="text-center text-gray-500 mt-12 pt-4 border-t border-gray-200">
            <p>心灵休憩空间 © 2025 - 愿你内心宁静，爱如少年（AI和魏之杭共同创建）</p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script>
        // 视觉放松效果功能
        const visualCanvas = document.getElementById('visualCanvas');
        const visualContainer = document.getElementById('visualContainer');
        const ctx = visualCanvas.getContext('2d');
        const effectBtns = document.querySelectorAll('.effect-btn');
        const breathingCircle = document.getElementById('breathingCircle');
        
        let currentEffect = '';
        let currentEffectBtn = null;
        let animationFrameId = null;
        let particles = [];
        let waves = [];
        let leaves = [];
        
        // 设置画布大小
        function resizeCanvas() {
            visualCanvas.width = visualContainer.clientWidth;
            visualCanvas.height = visualContainer.clientHeight;
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // 添加交互效果 - 点击事件
        visualContainer.addEventListener('click', function(e) {
            const rect = visualCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // 根据当前效果执行相应的交互
            switch(currentEffect) {
                case 'bubbles':
                    createBubbleBurst(x, y);
                    break;
                case 'waves':
                    createRippleEffect(x, y);
                    break;
                case 'breathing':
                    changeBreathingColor();
                    break;
                case 'leaves':
                    createLeafBurst(x, y);
                    break;
            }
        });
        
        // 创建泡泡爆发效果
        function createBubbleBurst(x, y) {
            const burstCount = 15;
            for (let i = 0; i < burstCount; i++) {
                const size = Math.random() * 40 + 5;
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 50 + 20;
                
                particles.push({
                    x: x + Math.cos(angle) * (Math.random() * 10),
                    y: y + Math.sin(angle) * (Math.random() * 10),
                    radius: size,
                    speed: Math.random() * 2 + 1,
                    color: getRandomPastelColor(),
                    opacity: Math.random() * 0.8 + 0.2,
                    delay: 0,
                    dx: Math.cos(angle) * distance * 0.05,
                    dy: Math.sin(angle) * distance * 0.05,
                    life: 100,
                    isBurst: true
                });
            }
        }
        
        // 创建波纹效果
        function createRippleEffect(x, y) {
            const ripple = document.createElement('div');
            ripple.classList.add('ripple');
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            visualContainer.appendChild(ripple);
            
            // 同时在波浪数组中添加一个特殊波浪
            waves.push({
                x: x,
                y: y,
                radius: 5,
                maxRadius: visualCanvas.width * 0.5,
                opacity: 0.7,
                speed: 0.5,
                isRipple: true
            });
            
            // 移除动画结束后的元素
            setTimeout(() => {
                ripple.remove();
            }, 1000);
        }
        
        // 改变呼吸圆环颜色
        function changeBreathingColor() {
            const hue = Math.floor(Math.random() * 360);
            const color = `hsl(${hue}, 70%, 80%)`;
            const endColor = `hsl(${hue}, 90%, 95%)`;
            
            breathingCircle.style.background = `radial-gradient(circle, ${color} 0%, ${endColor} 70%)`;
            
            // 添加光晕效果
            breathingCircle.style.boxShadow = `0 0 20px ${color}`;
            
            // 恢复原始样式
            setTimeout(() => {
                breathingCircle.style.boxShadow = '';
            }, 1000);
        }
        
        // 创建花瓣爆发效果
        function createLeafBurst(x, y) {
            const burstCount = 12;
            const leafEmojis = ['🌸', '🌺', '🍃', '🌷', '🌹', '🥀', '🌻'];
            
            for (let i = 0; i < burstCount; i++) {
                const size = Math.random() * 20 + 10;
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 2 + 1;
                
                leaves.push({
                    x: x,
                    y: y,
                    size: size,
                    shape: leafEmojis[Math.floor(Math.random() * leafEmojis.length)],
                    speed: speed,
                    rotation: Math.random() * 360,
                    rotationSpeed: Math.random() * 4 - 2,
                    angle: angle,
                    distance: Math.random() * 100 + 50,
                    progress: 0,
                    opacity: 1,
                    isBurst: true
                });
            }
        }
        
        // 泡泡效果
        function createBubbles() {
            particles = [];
            const bubbleCount = Math.floor(visualCanvas.width / 30);
            
            for (let i = 0; i < bubbleCount; i++) {
                const size = Math.random() * 50 + 10;
                particles.push({
                    x: Math.random() * visualCanvas.width,
                    y: visualCanvas.height + size,
                    radius: size,
                    speed: Math.random() * 2 + 0.5,
                    color: getRandomPastelColor(),
                    opacity: Math.random() * 0.6 + 0.2,
                    delay: Math.random() * 5000
                });
            }
        }
        
        function getRandomPastelColor() {
            const hue = Math.floor(Math.random() * 360);
            return `hsla(${hue}, 70%, 80%, 0.6)`;
        }
        
        function drawBubbles() {
            ctx.clearRect(0, 0, visualCanvas.width, visualCanvas.height);
            
            // 绘制常规泡泡
            for (let i = 0; i < particles.length; i++) {
                const p = particles[i];
                
                if (p.isBurst) {
                    // 处理爆发泡泡
                    p.x += p.dx;
                    p.y += p.dy;
                    p.life -= 1;
                    p.opacity = p.life / 100;
                    
                    if (p.life <= 0) {
                        particles.splice(i, 1);
                        i--;
                        continue;
                    }
                } else {
                    // 处理常规泡泡
                    // 应用延迟
                    if (Date.now() % 10000 > p.delay) {
                        p.y -= p.speed;
                        
                        // 泡泡随机左右移动
                        p.x += Math.sin(Date.now() / 1000 + i) * 0.5;
                        
                        // 如果泡泡飞出顶部，重新从底部开始
                        if (p.y < -p.radius * 2) {
                            p.y = visualCanvas.height + p.radius;
                            p.x = Math.random() * visualCanvas.width;
                        }
                    }
                }
                
                // 绘制泡泡
                ctx.beginPath();
                const gradient = ctx.createRadialGradient(
                    p.x, p.y, 0,
                    p.x, p.y, p.radius
                );
                gradient.addColorStop(0, `hsla(${p.color.split(',')[0].split('(')[1]}, 70%, 90%, ${p.opacity})`);
                gradient.addColorStop(1, p.color);
                
                ctx.fillStyle = gradient;
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // 添加高光
                ctx.beginPath();
                ctx.arc(p.x - p.radius * 0.3, p.y - p.radius * 0.3, p.radius * 0.2, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${p.opacity})`;
                ctx.fill();
            }
            
            if (currentEffect === 'bubbles') {
                animationFrameId = requestAnimationFrame(drawBubbles);
            }
        }
        
        // 波浪效果
        function createWaves() {
            waves = [];
            const waveCount = 7;
            
            for (let i = 0; i < waveCount; i++) {
                waves.push({
                    y: visualCanvas.height / 2,
                    amplitude: visualCanvas.height / 8,
                    speed: 0.005 + i * 0.002, // 降低波浪速度
                    offset: i * Math.PI / 4,
                    color: i % 2 === 0 ? '#90cdf4' : '#63b3ed'
                });
            }
        }
        
        function drawWaves() {
            ctx.clearRect(0, 0, visualCanvas.width, visualCanvas.height);
            
            // 绘制标准波浪
            for (let i = 0; i < waves.length; i++) {
                const wave = waves[i];
                
                if (wave.isRipple) {
                    // 绘制点击产生的波纹
                    ctx.beginPath();
                    ctx.arc(wave.x, wave.y, wave.radius, 0, Math.PI * 2);
                    ctx.strokeStyle = `rgba(99, 179, 237, ${wave.opacity})`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    // 更新波纹
                    wave.radius += wave.speed * 10;
                    wave.opacity -= 0.01;
                    
                    if (wave.opacity <= 0 || wave.radius >= wave.maxRadius) {
                        waves.splice(i, 1);
                        i--;
                        continue;
                    }
                } else {
                    // 绘制标准波浪
                    ctx.beginPath();
                    ctx.moveTo(0, visualCanvas.height);
                    
                    for (let x = 0; x < visualCanvas.width; x += 10) {
                        const y = wave.y + Math.sin(x * 0.01 + Date.now() * wave.speed + wave.offset) * wave.amplitude;
                        ctx.lineTo(x, y);
                    }
                    
                    ctx.lineTo(visualCanvas.width, visualCanvas.height);
                    ctx.lineTo(0, visualCanvas.height);
                    ctx.closePath();
                    
                    const gradient = ctx.createLinearGradient(0, 0, 0, visualCanvas.height);
                    gradient.addColorStop(0, `${wave.color}33`); // 33 is 20% opacity in hex
                    gradient.addColorStop(1, `${wave.color}00`); // 00 is 0% opacity in hex
                    
                    ctx.fillStyle = gradient;
                    ctx.fill();
                }
            }
            
            if (currentEffect === 'waves') {
                animationFrameId = requestAnimationFrame(drawWaves);
            }
        }
        
        // 飘落的树叶效果
        function createLeaves() {
            leaves = [];
            const leafCount = Math.floor(visualCanvas.width / 40);
            const leafEmojis = ['🌸', '🌺', '🍃', '🌷', '🌹', '🥀', '🌻'];
            
            for (let i = 0; i < leafCount; i++) {
                const size = Math.random() * 20 + 15;
                leaves.push({
                    x: Math.random() * visualCanvas.width,
                    y: -size * 2,
                    size: size,
                    shape: leafEmojis[Math.floor(Math.random() * leafEmojis.length)],
                    speed: Math.random() * 1 + 0.5,
                    rotation: Math.random() * 360,
                    rotationSpeed: Math.random() * 2 - 1,
                    swingFactor: Math.random() * 5 + 3,
                    swingOffset: Math.random() * Math.PI * 2,
                    delay: Math.random() * 5000
                });
            }
        }
        
        function drawLeaves() {
            ctx.clearRect(0, 0, visualCanvas.width, visualCanvas.height);
            
            for (let i = 0; i < leaves.length; i++) {
                const leaf = leaves[i];
                
                if (leaf.isBurst) {
                    // 处理爆发出的花瓣
                    leaf.progress += 0.01;
                    const distance = leaf.progress * leaf.distance;
                    leaf.x = leaf.x + Math.cos(leaf.angle) * 2;
                    leaf.y = leaf.y + Math.sin(leaf.angle) * 2;
                    leaf.rotation += leaf.rotationSpeed;
                    leaf.opacity = 1 - leaf.progress;
                    
                    if (leaf.progress >= 1) {
                        leaves.splice(i, 1);
                        i--;
                        continue;
                    }
                } else {
                    // 处理正常飘落的花瓣
                    // 应用延迟
                    if (Date.now() % 10000 > leaf.delay) {
                        leaf.y += leaf.speed;
                        leaf.rotation += leaf.rotationSpeed;
                        
                        // 摇摆运动
                        leaf.x += Math.sin(Date.now() / 1000 + leaf.swingOffset) / leaf.swingFactor;
                        
                        // 如果叶子飘出底部，重新从顶部开始
                        if (leaf.y > visualCanvas.height + leaf.size) {
                            leaf.y = -leaf.size * 2;
                            leaf.x = Math.random() * visualCanvas.width;
                        }
                    }
                }
                
                // 绘制叶子
                ctx.save();
                ctx.translate(leaf.x, leaf.y);
                ctx.rotate(leaf.rotation * Math.PI / 180);
                ctx.font = `${leaf.size}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                if (leaf.opacity !== undefined) {
                    ctx.globalAlpha = leaf.opacity;
                }
                
                ctx.fillText(leaf.shape, 0, 0);
                ctx.restore();
            }
            
            if (currentEffect === 'leaves') {
                animationFrameId = requestAnimationFrame(drawLeaves);
            }
        }
        
        // 呼吸引导效果
        function startBreathingEffect() {
            breathingCircle.style.display = 'block';
            visualCanvas.style.display = 'none';
        }
        
        function stopBreathingEffect() {
            breathingCircle.style.display = 'none';
            visualCanvas.style.display = 'block';
        }
        
        // 处理效果按钮点击
        effectBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // 停止当前动画
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                
                // 移除之前的选择状态
                if (currentEffectBtn) {
                    currentEffectBtn.classList.remove('active-effect');
                }
                
                // 添加新的选择状态
                this.classList.add('active-effect');
                currentEffectBtn = this;
                currentEffect = this.dataset.effect;
                
                // 隐藏呼吸圆圈(如果正在显示)
                stopBreathingEffect();
                
                // 启动相应的效果
                switch (currentEffect) {
                    case 'bubbles':
                        createBubbles();
                        drawBubbles();
                        break;
                    case 'waves':
                        createWaves();
                        drawWaves();
                        break;
                    case 'breathing':
                        startBreathingEffect();
                        break;
                    case 'leaves':
                        createLeaves();
                        drawLeaves();
                        break;
                }
            });
        });
        
        // 默认选择泡泡效果
        document.querySelector('[data-effect="bubbles"]').click();
        
        // 心情选择功能
        let selectedMood = '';
        
        function selectMood(mood) {
            selectedMood = mood;
            
            // 移除之前的选择状态
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-blue-500');
            });
            
            // 添加新的选择状态
            event.currentTarget.classList.add('ring-2', 'ring-blue-500');
        }
        
        // 生成唯一ID
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        }
        
        // 获取用户ID
        function getUserId() {
            let userId = localStorage.getItem('userId');
            if (!userId) {
                userId = generateUniqueId();
                localStorage.setItem('userId', userId);
            }
            return userId;
        }
        
        // 头像选择功能
        let selectedAvatar = localStorage.getItem('userAvatar') || 'anonymous';
        
        // 初始化头像选择状态
        document.addEventListener('DOMContentLoaded', function() {
            const avatarOptions = document.querySelectorAll('.avatar-option');
            
            // 设置已保存的头像选择状态
            avatarOptions.forEach(option => {
                if (option.dataset.avatar === selectedAvatar) {
                    option.classList.add('avatar-selected');
                }
                
                // 添加点击事件
                option.addEventListener('click', function() {
                    // 移除之前的选择状态
                    avatarOptions.forEach(opt => opt.classList.remove('avatar-selected'));
                    
                    // 添加新的选择状态
                    this.classList.add('avatar-selected');
                    
                    // 保存选择
                    selectedAvatar = this.dataset.avatar;
                    localStorage.setItem('userAvatar', selectedAvatar);
                });
            });
        });
        
        // 获取头像图标
        function getAvatarIcon(avatar) {
            switch(avatar) {
                case 'male1': return '<i class="fas fa-user text-blue-500"></i>';
                case 'female1': return '<i class="fas fa-female text-pink-500"></i>';
                case 'neutral1': return '<i class="fas fa-user-astronaut text-purple-500"></i>';
                case 'male2': return '<i class="fas fa-user-tie text-indigo-500"></i>';
                case 'female2': return '<i class="fas fa-user-nurse text-red-500"></i>';
                case 'anonymous':
                default: return '<i class="fas fa-user-circle text-gray-500"></i>';
            }
        }
        
        // 获取头像名称
        function getAvatarName(avatar) {
            switch(avatar) {
                case 'male1': return '蓝衣使者';
                case 'female1': return '粉红精灵';
                case 'neutral1': return '星际旅者';
                case 'male2': return '绅士先生';
                case 'female2': return '白衣天使';
                case 'anonymous':
                default: return '匿名用户';
            }
        }
        
        // 保存心情记录
        document.getElementById('saveMoodBtn').addEventListener('click', function() {
            const moodNote = document.getElementById('moodNote').value;
            const messageDiv = document.getElementById('moodMessage');
            
            if (!selectedMood && !moodNote) {
                messageDiv.textContent = "请选择心情或记录感受";
                messageDiv.classList.remove('hidden', 'text-green-500');
                messageDiv.classList.add('text-red-500');
                messageDiv.classList.remove('hidden');
                setTimeout(() => messageDiv.classList.add('hidden'), 3000);
                return;
            }
            
            // 获取当前时间
            const now = new Date();
            const formattedDate = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            // 创建心情记录对象
            const moodData = {
                id: generateUniqueId(),
                userId: getUserId(),
                mood: selectedMood,
                note: moodNote,
                date: formattedDate,
                avatar: selectedAvatar
            };
            
            // 获取现有记录
            let moodHistory = JSON.parse(localStorage.getItem('sharedMoodHistory')) || [];
            moodHistory.unshift(moodData); // 添加到数组开头
            
            // 保存到本地存储
            localStorage.setItem('sharedMoodHistory', JSON.stringify(moodHistory));
            
            // 显示成功消息
            messageDiv.textContent = "您的心情已记录";
            messageDiv.classList.remove('hidden', 'text-red-500');
            messageDiv.classList.add('text-green-500');
            messageDiv.classList.remove('hidden');
            setTimeout(() => messageDiv.classList.add('hidden'), 3000);
            
            // 重置表单
            selectedMood = '';
            document.getElementById('moodNote').value = '';
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-blue-500');
            });
            
            // 显示历史记录
            displayMoodHistory();
        });
        
        // 清除个人记录
        document.getElementById('clearPersonalBtn').addEventListener('click', function() {
            const userId = getUserId();
            let moodHistory = JSON.parse(localStorage.getItem('sharedMoodHistory')) || [];
            
            // 过滤出不是当前用户的记录
            moodHistory = moodHistory.filter(entry => entry.userId !== userId);
            
            // 保存更新后的记录
            localStorage.setItem('sharedMoodHistory', JSON.stringify(moodHistory));
            
            // 显示消息
            const messageDiv = document.getElementById('moodMessage');
            messageDiv.textContent = "您的记录已清除";
            messageDiv.classList.remove('hidden', 'text-red-500');
            messageDiv.classList.add('text-green-500');
            messageDiv.classList.remove('hidden');
            setTimeout(() => messageDiv.classList.add('hidden'), 3000);
            
            // 更新显示
            displayMoodHistory();
        });
        
        // 删除特定记录
        function deleteMoodRecord(recordId) {
            let moodHistory = JSON.parse(localStorage.getItem('sharedMoodHistory')) || [];
            
            // 找到要删除的记录索引
            const recordIndex = moodHistory.findIndex(entry => entry.id === recordId);
            
            if (recordIndex !== -1) {
                // 确保只删除属于当前用户的记录
                if (moodHistory[recordIndex].userId === getUserId()) {
                    moodHistory.splice(recordIndex, 1);
                    localStorage.setItem('sharedMoodHistory', JSON.stringify(moodHistory));
                    
                    // 显示消息
                    const messageDiv = document.getElementById('moodMessage');
                    messageDiv.textContent = "记录已删除";
                    messageDiv.classList.remove('hidden', 'text-red-500');
                    messageDiv.classList.add('text-green-500');
                    messageDiv.classList.remove('hidden');
                    setTimeout(() => messageDiv.classList.add('hidden'), 3000);
                    
                    // 更新显示
                    displayMoodHistory();
                }
            }
        }
        
        // 水平滚动控制
        document.getElementById('scrollLeftBtn').addEventListener('click', function() {
            document.getElementById('moodCardsContainer').scrollBy({
                left: -300,
                behavior: 'smooth'
            });
        });
        
        document.getElementById('scrollRightBtn').addEventListener('click', function() {
            document.getElementById('moodCardsContainer').scrollBy({
                left: 300,
                behavior: 'smooth'
            });
        });
        
        // 显示心情历史记录为横向卡片
        function displayMoodHistory() {
            const moodHistory = JSON.parse(localStorage.getItem('sharedMoodHistory')) || [];
            const cardsContainer = document.getElementById('moodCardsContainer');
            const noRecordsMessage = document.getElementById('noRecordsMessage');
            
            if (moodHistory.length > 0) {
                noRecordsMessage.classList.add('hidden');
                cardsContainer.innerHTML = '';
                
                moodHistory.forEach((entry, index) => {
                    let moodEmoji = '';
                    let moodClass = '';
                    
                    switch(entry.mood) {
                        case 'joyful': 
                            moodEmoji = '😊'; 
                            moodClass = 'bg-red-50 border-red-100';
                            break;
                        case 'calm': 
                            moodEmoji = '😌'; 
                            moodClass = 'bg-orange-50 border-orange-100';
                            break;
                        case 'excited': 
                            moodEmoji = '😃'; 
                            moodClass = 'bg-yellow-50 border-yellow-100';
                            break;
                        case 'tired': 
                            moodEmoji = '😔'; 
                            moodClass = 'bg-blue-50 border-blue-100';
                            break;
                        case 'anxious': 
                            moodEmoji = '😟'; 
                            moodClass = 'bg-purple-50 border-purple-100';
                            break;
                        default: 
                            moodEmoji = '📝';
                            moodClass = 'bg-gray-50 border-gray-100';
                    }
                    
                    const cardDiv = document.createElement('div');
                    cardDiv.className = `mood-history-card p-4 rounded-lg border card-animation ${moodClass}`;
                    cardDiv.style.animationDelay = `${index * 0.1}s`;
                    
                    // 是当前用户的记录则显示删除按钮
                    const deleteButton = entry.userId === getUserId() ? 
                        `<button class="delete-btn text-gray-400 hover:text-red-500 ml-2" onclick="deleteMoodRecord('${entry.id}')">
                            <i class="fas fa-times"></i>
                        </button>` : '';
                    
                    // 显示头像图标和名称
                    const avatarIcon = getAvatarIcon(entry.avatar || 'anonymous');
                    const avatarName = getAvatarName(entry.avatar || 'anonymous');
                    
                    cardDiv.innerHTML = `
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center">
                                <span class="text-xl mr-2">${moodEmoji}</span>
                                <div class="flex items-center">
                                    <span class="mr-2">${avatarIcon}</span>
                                    <span class="font-medium">${avatarName}</span>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <span class="text-xs text-gray-500">${entry.date}</span>
                                ${deleteButton}
                            </div>
                        </div>
                        ${entry.note ? `<p class="text-gray-700">${entry.note}</p>` : '<p class="text-gray-500 italic">无文字记录</p>'}
                    `;
                    
                    // 标记当前用户的记录
                    if (entry.userId === getUserId()) {
                        cardDiv.classList.add('border-l-4', 'border-l-blue-400');
                    }
                    
                    cardsContainer.appendChild(cardDiv);
                });
            } else {
                noRecordsMessage.classList.remove('hidden');
                cardsContainer.innerHTML = '';
            }
        }
        
        // 页面加载时显示历史记录
        window.addEventListener('load', displayMoodHistory);
    </script>
</body>
</html>



